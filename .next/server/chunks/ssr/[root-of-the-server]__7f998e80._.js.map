{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 207, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/genkit.ts"],"sourcesContent":["import {genkit} from 'genkit';\nimport {googleAI} from '@genkit-ai/googleai';\n\nexport const ai = genkit({\n  plugins: [googleAI()],\n  model: 'googleai/gemini-2.0-flash',\n});\n"],"names":[],"mappings":";;;AAAA;AAAA;AACA;AAAA;;;AAEO,MAAM,KAAK,CAAA,GAAA,uIAAA,CAAA,SAAM,AAAD,EAAE;IACvB,SAAS;QAAC,CAAA,GAAA,2KAAA,CAAA,WAAQ,AAAD;KAAI;IACrB,OAAO;AACT","debugId":null}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/flows/analyze-live-incidents-flow.ts"],"sourcesContent":["\n'use server';\n\n/**\n * @fileOverview A flow to analyze a list of live incidents from web searches.\n *\n * - analyzeLiveIncidents - A function that handles the live incident analysis process.\n * - AnalyzeLiveIncidentsInput - The input type for the analyzeLiveIncidents function.\n * - AnalyzeLiveIncidentsOutput - The return type for the analyzeLiveIncidents function.\n */\n\nimport { ai } from '@/ai/genkit';\nimport { z } from 'genkit';\n\nconst LiveIncidentSchema = z.object({\n  id: z.string(),\n  source: z.string(),\n  title: z.string(),\n  summary: z.string(),\n  url: z.string(),\n  timestamp: z.string(),\n  timeAgo: z.string(),\n  location: z.string(),\n});\n\nconst AnalyzeLiveIncidentsInputSchema = z.array(LiveIncidentSchema);\nexport type AnalyzeLiveIncidentsInput = z.infer<typeof AnalyzeLiveIncidentsInputSchema>;\n\nconst AnalyzeLiveIncidentsOutputSchema = z.object({\n    incidentCategory: z.string().describe(\"A concise category for the event (e.g., 'Protest', 'Road Closure', 'Public Event', 'Power Outage').\"),\n    analysisSummary: z.string().describe(\"A summary of the event and its potential impact on traffic, safety, or public access. Be specific. If a road is closed, mention the road's name. If there is a protest, mention the location.\"),\n    impactLevel: z.enum(['High', 'Moderate', 'Low']).describe(\"The assessed impact level on daily activities and commute. 'High' for major disruptions, 'Moderate' for significant delays, 'Low' for minor issues or clear routes.\"),\n});\nexport type AnalyzeLiveIncidentsOutput = z.infer<typeof AnalyzeLiveIncidentsOutputSchema>;\n\n\nexport async function analyzeLiveIncidents(input: AnalyzeLiveIncidentsInput): Promise<AnalyzeLiveIncidentsOutput> {\n  return analyzeLiveIncidentsFlow(input);\n}\n\nconst prompt = ai.definePrompt({\n  name: 'analyzeLiveIncidentsPrompt',\n  input: { schema: AnalyzeLiveIncidentsInputSchema },\n  output: { schema: AnalyzeLiveIncidentsOutputSchema },\n  prompt: `You are a civic intelligence analyst. Your task is to analyze a list of search results about local events and determine the potential impact on the public.\n\n  Review the following search result items:\n  {{#each this}}\n  - **Title:** {{title}}\n    - **URL:** {{url}}\n    - **Summary:** {{summary}}\n  {{/each}}\n  \n  **Analysis Tasks:**\n\n  1.  **Synthesize:** Read all the items and identify the core event or incident being reported.\n  2.  **Categorize:** Assign a single, concise category to this event (e.g., \"Protest\", \"Road Closure\", \"Infrastructure Work\", \"Public Event\", \"Power Outage\").\n  3.  **Summarize Impact:** Write a brief, one or two-sentence summary describing the event and its most likely impact on public commute and daily activities. Be very specific. Instead of \"a road is closed\", write \"Main Street is closed between 1st and 3rd Avenue\". Extract the specific names of locations, streets, or areas from the search results.\n  4.  **Assess Impact Level:** Based on the summary, determine the overall impact level.\n        - **High:** The event will cause major disruptions, road closures, or safety risks. Commute is heavily affected.\n        - **Moderate:** The event will likely cause significant delays or detours.\n        - **Low:** The event has a minor effect on commute or is just for general awareness.\n\n  Provide the output in the requested structured format.\n  `,\n});\n\nconst analyzeLiveIncidentsFlow = ai.defineFlow(\n  {\n    name: 'analyzeLiveIncidentsFlow',\n    inputSchema: AnalyzeLiveIncidentsInputSchema,\n    outputSchema: AnalyzeLiveIncidentsOutputSchema,\n  },\n  async (input) => {\n    // If there are no incidents, return a default \"clear\" state.\n    if (input.length === 0) {\n        return {\n            incidentCategory: 'No Incidents',\n            analysisSummary: 'No significant civic incidents or disruptions were found in the selected area for the last 48 hours.',\n            impactLevel: 'Low',\n        };\n    }\n    const { output } = await prompt(input);\n    return output!;\n  }\n);\n"],"names":[],"mappings":";;;;;AAGA;;;;;;CAMC,GAED;AACA;AAAA;;;;;;AAEA,MAAM,qBAAqB,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAClC,IAAI,uIAAA,CAAA,IAAC,CAAC,MAAM;IACZ,QAAQ,uIAAA,CAAA,IAAC,CAAC,MAAM;IAChB,OAAO,uIAAA,CAAA,IAAC,CAAC,MAAM;IACf,SAAS,uIAAA,CAAA,IAAC,CAAC,MAAM;IACjB,KAAK,uIAAA,CAAA,IAAC,CAAC,MAAM;IACb,WAAW,uIAAA,CAAA,IAAC,CAAC,MAAM;IACnB,SAAS,uIAAA,CAAA,IAAC,CAAC,MAAM;IACjB,UAAU,uIAAA,CAAA,IAAC,CAAC,MAAM;AACpB;AAEA,MAAM,kCAAkC,uIAAA,CAAA,IAAC,CAAC,KAAK,CAAC;AAGhD,MAAM,mCAAmC,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC9C,kBAAkB,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACtC,iBAAiB,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACrC,aAAa,uIAAA,CAAA,IAAC,CAAC,IAAI,CAAC;QAAC;QAAQ;QAAY;KAAM,EAAE,QAAQ,CAAC;AAC9D;AAIO,eAAe,qBAAqB,KAAgC;IACzE,OAAO,yBAAyB;AAClC;AAEA,MAAM,SAAS,mHAAA,CAAA,KAAE,CAAC,YAAY,CAAC;IAC7B,MAAM;IACN,OAAO;QAAE,QAAQ;IAAgC;IACjD,QAAQ;QAAE,QAAQ;IAAiC;IACnD,QAAQ,CAAC;;;;;;;;;;;;;;;;;;;;EAoBT,CAAC;AACH;AAEA,MAAM,2BAA2B,mHAAA,CAAA,KAAE,CAAC,UAAU,CAC5C;IACE,MAAM;IACN,aAAa;IACb,cAAc;AAChB,GACA,OAAO;IACL,6DAA6D;IAC7D,IAAI,MAAM,MAAM,KAAK,GAAG;QACpB,OAAO;YACH,kBAAkB;YAClB,iBAAiB;YACjB,aAAa;QACjB;IACJ;IACA,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,OAAO;IAChC,OAAO;AACT;;;IAhDoB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 327, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/live-incidents-service.ts"],"sourcesContent":["\n'use server';\n\nimport { formatDistanceToNow } from 'date-fns';\nimport { analyzeLiveIncidents, AnalyzeLiveIncidentsOutput } from '@/ai/flows/analyze-live-incidents-flow';\n\nexport interface LiveIncident {\n  id: string;\n  source: 'Web' | 'Social Media' | 'Official';\n  title: string;\n  summary: string;\n  url: string;\n  timestamp: string; // ISO string\n  timeAgo: string;\n  location: string;\n}\n\nexport interface AnalyzedIncidentReport {\n    analysis: AnalyzeLiveIncidentsOutput;\n    supportingIncidents: LiveIncident[];\n}\n\ninterface PerplexitySearchResult {\n    title: string;\n    url: string;\n    summary?: string;\n}\n\nasync function performPerplexitySearch(apiKey: string, prompt: string): Promise<PerplexitySearchResult[]> {\n    const url = \"https://api.perplexity.ai/chat/completions\";\n    const payload = {\n        model: \"sonar\",\n        messages: [{ \"role\": \"user\", \"content\": prompt }],\n    };\n    const headers = {\n        \"Authorization\": `Bearer ${apiKey}`,\n        \"Content-Type\": \"application/json\"\n    };\n\n    const response = await fetch(url, {\n        method: 'POST',\n        body: JSON.stringify(payload),\n        headers: headers\n    });\n\n    const responseData = await response.json();\n\n    if (!response.ok) {\n        console.error(\"Perplexity API Error:\", responseData);\n        // Don't throw, just return empty so one search failing doesn't kill the whole feature\n        return []; \n    }\n\n    return responseData.search_results || [];\n}\n\n\nexport async function getLiveIncidents(location: {\n  lat: number;\n  lng: number;\n  address: string;\n}): Promise<{ success: boolean; data?: AnalyzedIncidentReport[], error?: string }> {\n  const apiKey = process.env.PERPLEXITY_API_KEY;\n\n  if (!apiKey) {\n    return { success: false, error: 'Perplexity API key is not configured. Please add PERPLEXITY_API_KEY to your .env file.' };\n  }\n  \n  const trafficPrompt = `Find real-time and upcoming civic incidents for the location \"${location.address}\". Search only for the last 2 days. Focus exclusively on events that disrupt public commute and daily activities. Consolidate multiple reports of the same event into a single summary.\n\nInclude only the following types of events:\n- Traffic alerts, accidents, and road changes\n- Road closures (temporary or long-term)\n- Public protests, demonstrations, or mass gatherings\n- Visits by politicians or VIPs causing traffic regulation changes\n- Natural calamities (e.g., water logging, flooding, tree fall)`;\n\n  const electricityPrompt = `Find official announcements or news about power cuts, electrical maintenance schedules, or major electrical faults from the local electricity board or utility provider for the area of \"${location.address}\". Search only for the last 48 hours.`;\n\n\n  try {\n    const [trafficResults, electricityResults] = await Promise.all([\n        performPerplexitySearch(apiKey, trafficPrompt),\n        performPerplexitySearch(apiKey, electricityPrompt)\n    ]);\n    \n    const allReports: AnalyzedIncidentReport[] = [];\n\n    // Analyze Traffic Incidents\n    const trafficIncidents: LiveIncident[] = trafficResults.map((item: PerplexitySearchResult, index: number) => ({\n        id: `traffic-${index}-${new Date().getTime()}`,\n        source: 'Web', title: item.title, summary: item.summary || 'Source: ' + new URL(item.url).hostname,\n        url: item.url, timestamp: new Date().toISOString(), timeAgo: 'Just now', location: location.address,\n    }));\n    const trafficAnalysis = await analyzeLiveIncidents(trafficIncidents);\n    allReports.push({ analysis: trafficAnalysis, supportingIncidents: trafficIncidents });\n\n    // Analyze Electricity Incidents\n    const electricityIncidents: LiveIncident[] = electricityResults.map((item: PerplexitySearchResult, index: number) => ({\n        id: `elec-${index}-${new Date().getTime()}`,\n        source: 'Web', title: item.title, summary: item.summary || 'Source: ' + new URL(item.url).hostname,\n        url: item.url, timestamp: new Date().toISOString(), timeAgo: 'Just now', location: location.address,\n    }));\n    const electricityAnalysis = await analyzeLiveIncidents(electricityIncidents);\n    allReports.push({ analysis: electricityAnalysis, supportingIncidents: electricityIncidents });\n\n    return { success: true, data: allReports };\n\n  } catch (error: any) {\n    console.error(\"Error fetching live incidents:\", error);\n    return { success: false, error: error.message || \"An unknown error occurred.\" };\n  }\n}\n"],"names":[],"mappings":";;;;;AAIA;;;;;AAwBA,eAAe,wBAAwB,MAAc,EAAE,MAAc;IACjE,MAAM,MAAM;IACZ,MAAM,UAAU;QACZ,OAAO;QACP,UAAU;YAAC;gBAAE,QAAQ;gBAAQ,WAAW;YAAO;SAAE;IACrD;IACA,MAAM,UAAU;QACZ,iBAAiB,CAAC,OAAO,EAAE,QAAQ;QACnC,gBAAgB;IACpB;IAEA,MAAM,WAAW,MAAM,MAAM,KAAK;QAC9B,QAAQ;QACR,MAAM,KAAK,SAAS,CAAC;QACrB,SAAS;IACb;IAEA,MAAM,eAAe,MAAM,SAAS,IAAI;IAExC,IAAI,CAAC,SAAS,EAAE,EAAE;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,sFAAsF;QACtF,OAAO,EAAE;IACb;IAEA,OAAO,aAAa,cAAc,IAAI,EAAE;AAC5C;AAGO,eAAe,iBAAiB,QAItC;IACC,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IAE7C,IAAI,CAAC,QAAQ;QACX,OAAO;YAAE,SAAS;YAAO,OAAO;QAAyF;IAC3H;IAEA,MAAM,gBAAgB,CAAC,8DAA8D,EAAE,SAAS,OAAO,CAAC;;;;;;;+DAO3C,CAAC;IAE9D,MAAM,oBAAoB,CAAC,yLAAyL,EAAE,SAAS,OAAO,CAAC,qCAAqC,CAAC;IAG7Q,IAAI;QACF,MAAM,CAAC,gBAAgB,mBAAmB,GAAG,MAAM,QAAQ,GAAG,CAAC;YAC3D,wBAAwB,QAAQ;YAChC,wBAAwB,QAAQ;SACnC;QAED,MAAM,aAAuC,EAAE;QAE/C,4BAA4B;QAC5B,MAAM,mBAAmC,eAAe,GAAG,CAAC,CAAC,MAA8B,QAAkB,CAAC;gBAC1G,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,EAAE,IAAI,OAAO,OAAO,IAAI;gBAC9C,QAAQ;gBAAO,OAAO,KAAK,KAAK;gBAAE,SAAS,KAAK,OAAO,IAAI,aAAa,IAAI,IAAI,KAAK,GAAG,EAAE,QAAQ;gBAClG,KAAK,KAAK,GAAG;gBAAE,WAAW,IAAI,OAAO,WAAW;gBAAI,SAAS;gBAAY,UAAU,SAAS,OAAO;YACvG,CAAC;QACD,MAAM,kBAAkB,MAAM,CAAA,GAAA,0JAAA,CAAA,uBAAoB,AAAD,EAAE;QACnD,WAAW,IAAI,CAAC;YAAE,UAAU;YAAiB,qBAAqB;QAAiB;QAEnF,gCAAgC;QAChC,MAAM,uBAAuC,mBAAmB,GAAG,CAAC,CAAC,MAA8B,QAAkB,CAAC;gBAClH,IAAI,CAAC,KAAK,EAAE,MAAM,CAAC,EAAE,IAAI,OAAO,OAAO,IAAI;gBAC3C,QAAQ;gBAAO,OAAO,KAAK,KAAK;gBAAE,SAAS,KAAK,OAAO,IAAI,aAAa,IAAI,IAAI,KAAK,GAAG,EAAE,QAAQ;gBAClG,KAAK,KAAK,GAAG;gBAAE,WAAW,IAAI,OAAO,WAAW;gBAAI,SAAS;gBAAY,UAAU,SAAS,OAAO;YACvG,CAAC;QACD,MAAM,sBAAsB,MAAM,CAAA,GAAA,0JAAA,CAAA,uBAAoB,AAAD,EAAE;QACvD,WAAW,IAAI,CAAC;YAAE,UAAU;YAAqB,qBAAqB;QAAqB;QAE3F,OAAO;YAAE,SAAS;YAAM,MAAM;QAAW;IAE3C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO,IAAI;QAA6B;IAChF;AACF;;;IAvDsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 443, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/live-agent/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getLiveIncidents as '40345ca53538fa85c76ef155f22942baa3aeea00ea'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 495, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/live-agent/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/live-agent/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/live-agent/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA+R,GAC5T,6DACA","debugId":null}},
    {"offset": {"line": 509, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/live-agent/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/live-agent/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/live-agent/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA2Q,GACxS,yCACA","debugId":null}},
    {"offset": {"line": 523, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}